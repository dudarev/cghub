jQuery(function(e){"use strict";var t={};this.cghub!==undefined?t=this.cghub:this.cghub=t,t.search={addToCartErrorTitle:"Error Adding to Cart",addToCartErrorContent:'There was an error while adding to the cart. Please contact admin: <a href="mailto:support@cghub.ucsc.edu">support@cghub.ucsc.edu</a>',nothingSelectedTitle:"No selected files",nothingSelectedContent:"Please select some files to add them to cart",init:function(){t.search.cacheElements(),t.search.bindEvents(),t.search.initFlexigrid(),t.search.parseAppliedFilters(),t.search.initDdcl(),t.search.initCustomPeriodButtons()},cacheElements:function(){t.search.$searchTable=e("table.data-table"),t.search.$addFilesForm=e("form#id_add_files_form"),t.search.$addFilesButton=e(".add-to-cart-btn"),t.search.$addAllFilesButton=e("button.add-all-to-cart-btn"),t.search.$applyFiltersButton=e("button#id_apply_filters"),t.search.$resetFiltersButton=e("button#id_reset_filters"),t.search.$selectAllLink=e(".select-all"),t.search.$deselectAllLink=e(".clear-all"),t.search.$filterSelects=e("select.filter-select"),t.search.$navbarSearchForm=e("form.navbar-search"),t.search.$messageModal=e("#messageModal"),t.search.$manyItemsModal=e("#manyItemsModal"),t.search.$spinner=e(".js-spinner"),t.search.$numResults=e(".js-num-results"),t.search.$searchField=e(".navbar-search input")},bindEvents:function(){t.search.$navbarSearchForm.on("submit",t.search.onNavbarSearchFormSubmit),t.search.$addFilesForm.on("submit",t.search.addFilesFormSubmit),t.search.$applyFiltersButton.on("click",t.search.applyFilters),t.search.$resetFiltersButton.on("click",t.search.resetFilters),t.search.$addAllFilesButton.on("click",t.search.addAllFilesClick),t.search.$manyItemsModal.find(".js-yes").on("click",t.search.addAllFiles)},onNavbarSearchFormSubmit:function(){return t.search.applyFilters(),!1},parseAppliedFilters:function(){var n={};e(".applied-filters ul li").each(function(){var t=e(this).data("filters");typeof t=="number"&&(t<10?t="0"+t:t=""+t),n[e(this).data("name")]=t.split("&")}),t.search.$filterSelects.each(function(r,i){var s=e(i),o=s.attr("data-section");if(o in n)if(o=="refassem_short_name")s.find("option").each(function(t,r){var i=e(r).val().split(" OR "),s=!0;for(var u=0;u<i.length;u++)if(e.inArray(i[u],n[o])==-1){s=!1;break}s&&e(r).attr("selected","selected")});else if(o=="last_modified"||o=="upload_date"){var u=n[o][0],a=s.find('option[value = "'+u+'"]');if(a.length>0)a.attr("selected","selected");else{var f=e("<option/>").attr({selected:"selected",value:u}).text(t.search.convertValueToPeriod(u));s.append(f)}}else for(var r=0;r<n[o].length;r++)s.find('option[value="'+n[o][r]+'"]').attr("selected","selected");else s.find('option[value=""]').attr("selected","selected"),s.find('option[value="(all)"]').attr("selected","selected")}),"q"in n&&e("input.search-query").val(n.q)},initFlexigrid:function(){t.search.$searchTable.flexigrid({height:"auto",showToggleBtn:!1}),e(".flexigrid .bDiv tr").contextmenu()},initDdcl:function(){for(var n=0;n<t.search.$filterSelects.length;n++){var r=t.search.$filterSelects[n];if(e(r).hasClass("date-filters"))e(r).dropdownchecklist({width:180,zIndex:1010,explicitClose:"close"});else{e(r).dropdownchecklist({firstItemChecksAll:!0,width:180,zIndex:1010,textFormatFunction:t.search.ddclTextFormatFunction,onComplete:t.search.ddclOnComplete,explicitClose:"close"}),e(r).next().find(".ui-dropdownchecklist-selector").click(function(){e(this).css("height","18px"),e(this).find(".ui-dropdownchecklist-text").html("selecting...").css({color:"#08c"})});var i=e(r).next().next().width();e(r).next().next().width(i+10),t.search.ddclOnComplete(r)}e(r).attr("id",e(r).prev().attr("for"))}e(".sidebar").css("visibility","visible"),e.browser.msie&&(console.log("init msie"),e(document).on("keydown",".ui-dropdownchecklist-dropcontainer",function(e){if(e.which==13)return!1}))},ddclTextFormatFunction:function(t){return e(t).parent().next().find(".ui-dropdownchecklist-text").html("selecting...").css({color:"#08c"}),"selecting..."},ddclOnComplete:function(t){var n="",r=0,i="#333";e(t).next().next().find(".ui-dropdownchecklist-item:has(input:checked)").each(function(t,i){n+='<span class="ui-dropdownchecklist-text-item">'+e(i).find("label").html()+"</span><br>",r++}),r===0&&(r=1,n="Please select"),n.indexOf("(all)")!=-1&&(r=1,n="All"),e(t).next().find(".ui-dropdownchecklist-selector").css("height","auto"),e(t).next().find(".ui-dropdownchecklist-text").html(n).css({color:i}),e('.ui-dropdownchecklist-text[title="selecting..."]').each(function(){e(this).removeAttr("title")})},addFilesFormSubmit:function(){if(t.search.$addFilesButton.hasClass("disabled"))return!1;t.search.$addFilesButton.addClass("disabled"),t.search.$spinner.show();var n={},r=e('input[type="checkbox"][name="selected_files"]:checked');return r.length==0?(t.base.showMessage(t.search.nothingSelectedTitle,t.search.nothingSelectedContent),t.search.$addFilesButton.removeClass("disabled"),t.search.$spinner.hide(),!1):(r.each(function(t,r){var i=e(r).data();n[i.analysis_id]=i}),e.ajax({data:e(this).serialize()+"&attributes="+JSON.stringify(n),type:e(this).attr("method"),dataType:"json",url:e(this).attr("action"),success:function(e){e["action"]=="redirect"?window.location.href=e.redirect:(t.base.showMessage(t.search.addToCartErrorTitle,t.search.addToCartErrorContent),t.search.$addFilesButton.removeClass("disabled"),t.search.$spinner.hide())},error:function(){t.base.showMessage(t.search.addToCartErrorTitle,t.search.addToCartErrorContent),t.search.$addFilesButton.removeClass("disabled"),t.search.$spinner.hide()}}),!1)},addAllFilesClick:function(){if(e(this).hasClass("disabled"))return!1;var n=parseInt(t.search.$numResults.text(),10),r=parseInt(e(this).parents("form").data("many-files"));return n>r?(t.search.$manyItemsModal.find(".modal-body p b").text(n),t.search.$manyItemsModal.modal("show"),t.search.$manyItemsModal.find(".js-no").focus()):t.search.addAllFiles(),!1},addAllFiles:function(){var n=URI.parseQuery(window.location.search);if(jQuery.isEmptyObject(n)){var r=t.search.getFiltersValues();if(r.is_error)return!1;n=r.filters}var i=t.search.$addAllFilesButton;i.addClass("disabled"),t.search.$spinner.show();var s=i.parents("form");return e.ajax({data:s.serialize()+"&filters="+JSON.stringify(n),type:s.attr("method"),dataType:"json",url:s.attr("action"),success:function(n){if("task_id"in n){var r=e.cookie("active_tasks");r?(r=r.split(","),r.push(n.task_id),e.cookie("active_tasks",r.join(","),{path:"/",expires:7})):e.cookie("active_tasks",n.task_id,{path:"/",expires:7})}n["action"]=="redirect"&&(window.location.href=n.redirect),n["action"]=="message"&&(t.base.showMessage(n.title,n.content),e(i).removeClass("disabled"),t.search.$spinner.hide()),n["action"]=="error"&&(t.base.showMessage(t.search.addToCartErrorTitle,t.search.addToCartErrorContent),e(i).removeClass("disabled"),t.search.$spinner.hide())},error:function(){t.base.showMessage(t.search.addToCartErrorTitle,t.search.addToCartErrorContent),e(i).removeClass("disabled"),t.search.$spinner.hide()}}),t.search.$manyItemsModal.modal("hide"),!1},getFiltersValues:function(){var n=URI.parseQuery(window.location.search),r=!t.search.checkSearchField(),i=e("select.filter-select:not(.date-filters)"),s=e("input.search-query").val();return s=="Search"&&(s=""),i.each(function(t,i){var s=e(i).next().next(),o=Boolean(s.find('input[value = "(all)"]:checked').length),u="",a=e(i).attr("data-section");return!o&&s.find("input:checked").length!==0?(s.find("input:checked").each(function(t,n){u+=e(n).val()+" OR "}),n[a]="("+u.slice(0,-4)+")",!0):o?(delete n[a],!0):(alert("Select some values."),r=!0,!1)}),(s===""||window.location.search!=="")&&e(".date-filters").each(function(){var t=e(this).find("option:selected").val();t!==""?n[e(this).attr("data-section")]=t:delete n[e(this).attr("data-section")]}),s!==""?n.q=s:delete n.q,delete n.limit,delete n.offset,{is_error:r,filters:n}},applyFilters:function(){var n=t.search.getFiltersValues(),r=URI(location.href);n.is_error||(window.location.href=r.search(n.filters)),e(this).blur()},resetFilters:function(){var t=e(this).data("url");e.removeCookie("last_query",{path:t}),window.location.href=t,e(this).blur()},createCustomDatepickers:function(){e(".dp-container").remove();var t=e("<div/>").addClass("dp-container well"),n=e("<h6/>").text("Please select the period"),r=e('<div class="dp-date" id="dp-start" data-defaultdate="+0d">'),i=e('<div class="dp-date" id="dp-end" data-defaultdate="+0d">'),s=e("<button/>").addClass("btn-submit btn").attr("type","submit").text("Submit"),o=e("<button/>").addClass("btn-cancel btn").text("Cancel");return e.each([n,r,i,e("<br/>"),s,o],function(n,r){e(this).appendTo(t)}),e.each([r,i],function(t,n){var r=e(this);r.datepicker({changeMonth:!0,changeYear:!0,defaultDate:r.data("defaultdate"),yearRange:"c-2y:c",dateFormat:"yy/mm/dd",onChangeMonthYear:function(e,t,n){var i=(new Date(e,t,0)).getDate(),s=r.datepicker("getDate");s.getDate()>i?s.setMonth(t-1,i):s.setMonth(t-1),s.setYear(e),r.datepicker("setDate",s)}})}),t},initCustomPeriodButtons:function(){e('.sidebar input[value="[NOW-1YEAR TO NOW]"]').each(function(n,r){e(r).parent().parent().find(".ui-dropdownchecklist-close").before(e('<div class="ui-state-default ui-dropdownchecklist-item js-pick-period" style="text-align: center"><span class="ui-dropdownchecklist-text">Pick period</span></div>').hover(function(){e(this).addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover")}).click(function(){var n=t.search.createCustomDatepickers().css("top",e(r).parents(".ui-dropdownchecklist-dropcontainer-wrapper").offset().top-40).appendTo(".sidebar");n.find(".btn-cancel").click(function(){return n.remove(),!1}),n.find(".btn-submit").click(function(){var i=n.find("#dp-start").datepicker({dateFormat:"yy/mm/dd"}).val(),s=n.find("#dp-end").datepicker({dateFormat:"yy/mm/dd"}).val(),o=t.search.convertPeriodToValue(i,s),u=e(r).parents(".ui-dropdownchecklist-dropcontainer-wrapper"),a=u.prev().prev();return u.find("input").prop("checked",!1).change(function(){a.find("option").attr("selected",!1),a.find('option[value = "'+e(this).val()+'"]').attr("selected","selected"),a.find(".js-custom-option").remove(),a.dropdownchecklist("refresh")}),a.find("option").attr("selected",!1),a.find(".js-custom-option").remove(),a.append(e("<option/>").attr({value:o,selected:"selected"}).text(t.search.convertValueToPeriod(o)).addClass("js-custom-option")),a.dropdownchecklist("refresh"),n.remove(),!1})}))})},convertPeriodToValue:function(t,n){var r=864e5,i=new Date,s=Date.parse(i),o=Date.parse(n),u=Date.parse(t);e(".dp-container > .text-error").remove(),u>s&&(u=s),o>s&&(o=s);if(o<u){var a=u;u=o,o=a}var f=Math.floor((s-o)/r),l=Math.floor((s-u)/r);l==f&&(l+=1);var c="[NOW-"+l+"DAY",h="NOW-"+f+"DAY]";return(s-o)/r<1&&(h="NOW]"),c+" TO "+h},convertValueToPeriod:function(t){var n=864e5,r=new Date,i=Date.parse(r),s=t.slice(1,-1).split(" TO "),o=parseInt(s[0].split("-").reverse()[0].slice(0,-3)),u=parseInt(s[1].split("-").reverse()[0].slice(0,-3));isNaN(o)?o=0:o*=n,isNaN(u)?u=0:u*=n;var a=new Date(i-o),f=new Date(i-u);return a=e.datepicker.formatDate("yy/mm/dd",a),f=e.datepicker.formatDate("yy/mm/dd",f),a+" - "+f},checkSearchField:function(){var e=t.search.$searchField.val();for(var n=0;n<t.base.reservedChars.length;n++)if(e.indexOf(t.base.reservedChars[n])!=-1)return t.base.showMessage(t.base.usedReservedCharsTitle,t.base.usedReservedCharsContent),!1;return!0}},t.search.init()}),jQuery(function(e){"use strict";var t={};this.cghub!==undefined?t=this.cghub:this.cghub=t,t.table={init:function(){t.table.cacheElements(),t.table.bindEvents(),t.table.selectFiles(),t.table.$selectAllCheckbox.removeAttr("disabled")},cacheElements:function(){t.table.$flexigridTable=e(".flexigrid"),t.table.$itemsPerPageLink=e("div.items-per-page-label > a"),t.table.$selectAllCheckbox=e(".js-select-all"),t.table.$checkboxes=e(".data-table-checkbox")},bindEvents:function(){t.table.activateItemDetailsLinks(),t.table.$itemsPerPageLink.on("click",t.table.saveSelectedFiles),t.table.$selectAllCheckbox.on("change",t.table.changeCheckboxes),t.table.$checkboxes.on("change",t.table.updateSelectAll),t.table.$checkboxes.on("focusin",t.table.focusInOutCheckbox),t.table.$checkboxes.on("focusout",t.table.focusInOutCheckbox),e(document).on("keydown",t.table.arrowShiftPress)},activateItemDetailsLinks:function(){e(document).on("click",".bDiv tr",function(t){var n=e(t.target).find("input[name=selected_files]");if(t.target.name=="selected_files"||n.length)return;var r=e(this),i=e(r.attr("data-target")),s=!1;return i.on("shown",function(){s||i.find(".modal-body").load(r.attr("data-details-url"),function(e,t,n){t=="error"?i.find(".modal-body").html("There was an error loading data. Please contact admin."):s=!0})}).on("show",function(){i.find(".modal-body").html("Loading ..."),i.find(".modal-label").html("Details for Analysis Id "+r.attr("data-analysis_id"))}).modal("show"),!1}),e(document).on("click",".js-details-popup",function(){var t=e(e(this).parents("ul").data("e").target).parents("td");return t.trigger("click"),!1}),e(document).on("click",".js-details-page",function(){var t=e(e(this).parents("ul").data("e").target).parents("tr");return window.open(t.attr("data-details-url"),"_blank"),window.focus(),!1})},changeCheckboxes:function(){t.table.$checkboxes.prop("checked",e(this).is(":checked"));return},updateSelectAll:function(){t.table.$selectAllCheckbox.prop("checked",t.table.$checkboxes.length==e(".data-table-checkbox:checked").length)},selectFiles:function(){var t=e.cookie("browser_checked_items");if(t){t=t.split(",");for(var n in t){var r=e(".data-table-checkbox[value="+t[n]+"]");r.length&&r.prop("checked",!0)}e("input.data-table-checkbox:checked").length==e("input.data-table-checkbox").length&&e(".js-select-all").prop("checked",!0),e.removeCookie("browser_checked_items",{path:"/"})}},saveSelectedFiles:function(){var t=[];e("form .data-table-checkbox").serializeArray().map(function(e){t.push(e.value)}),e.cookie("browser_checked_items",t.join(","),{path:"/",expires:7})},focusInOutCheckbox:function(t){t.type=="focusin"?e(this).parents("td").addClass("tdSelected"):t.type=="focusout"&&(e(this).parents("td").removeClass("tdSelected"),e("td.tdSelected").removeClass("tdSelected"))},arrowShiftPress:function(t){var n=t.which?t.which:t.keyCode;if(t.shiftKey){var r=e("td.tdSelected"),i;n==37&&(i=e(r).prev()),n==39&&(i=e(r).next());if(i==null||i.length!=1)return;r.removeClass("tdSelected"),i.addClass("tdSelected")}}},t.table.init()});