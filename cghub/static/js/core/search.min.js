jQuery(function(a){"use strict";var b={};this.cghub!==undefined?b=this.cghub:this.cghub=b,b.search={init:function(){b.search.cacheElements(),b.search.bindEvents(),b.search.initFlexigrid(),b.search.parseFiltersFromHref(),b.search.initDdcl()},cacheElements:function(){b.search.$searchTable=a("table.data-table"),b.search.$addFilesForm=a("form#id_add_files_form"),b.search.$addAllFilesButton=a("button.add-all-to-cart-btn"),b.search.$applyFiltersButton=a("button#id_apply_filters"),b.search.$resetFiltersButton=a("button#id_reset_filters"),b.search.$selectAllLink=a(".select-all"),b.search.$deselectAllLink=a(".clear-all"),b.search.$filterSelects=a("select.filter-select"),b.search.$navbarSearchForm=a("form.navbar-search")},bindEvents:function(){b.search.$navbarSearchForm.on("submit",b.search.onNavbarSearchFormSubmit),b.search.$addFilesForm.on("submit",b.search.addFilesFormSubmit),b.search.$applyFiltersButton.on("click",b.search.applyFilters),b.search.$resetFiltersButton.on("click",b.search.resetFilters),b.search.$addAllFilesButton.on("click",b.search.addAllFilesClick)},onNavbarSearchFormSubmit:function(){return b.search.applyFilters(),!1},parseFiltersFromHref:function(){var c=URI.parseQuery(window.location.search);b.search.$filterSelects.each(function(b,d){var e=a(d),f=e.attr("section");if(f in c)if(f=="last_modified"||f=="upload_date"){var g=c[f];e.find('option[value = "'+g+'"]').attr("selected","selected")}else{var h=c[f].slice(1,-1).split(" OR ");if(f=="refassem_short_name")for(var b=h.length-1;b>=0;b--)e.find('option[value *= "'+h[b]+'"]').attr("selected","selected");else for(var b=h.length-1;b>=0;b--)e.find('option[value = "'+h[b]+'"]').attr("selected","selected")}else f=="last_modified"||f=="upload_date"?window.location.search===""?e.find('option[value = "[NOW-1MONTH TO NOW]"]').attr("selected","selected"):e.find('option[value = ""]').attr("selected","selected"):f=="state"?window.location.pathname.indexOf("search")>0?e.find('option[value = "(all)"]').attr("selected","selected"):e.find('option[value = "live"]').attr("selected","selected"):f=="study"?window.location.pathname.indexOf("search")>0?e.find('option[value = "(all)"]').attr("selected","selected"):e.find('option[value = "phs000178"]').attr("selected","selected"):e.find('option[value = "(all)"]').attr("selected","selected")});var d=a("#modified-filter-applied").attr("data");a(".date-filters[section='last_modified']").find('option[value = "'+d+'"]').attr("selected","selected");var e=a("#uploaded-filter-applied").attr("data");a(".date-filters[section='upload_date']").find('option[value = "'+e+'"]').attr("selected","selected"),"q"in c&&a("input.search-query").val(c.q)},initFlexigrid:function(){b.search.$searchTable.flexigrid({height:"auto",showToggleBtn:!1}),a(".flexigrid .bDiv tr").contextmenu()},initDdcl:function(){for(var c=b.search.$filterSelects.length-1;c>=0;c--){var d=b.search.$filterSelects[c];if(a(d).hasClass("date-filters"))a(d).dropdownchecklist({width:170,explicitClose:"close"});else{a(d).dropdownchecklist({firstItemChecksAll:!0,width:170,textFormatFunction:b.search.ddclTextFormatFunction,onComplete:b.search.ddclOnComplete,explicitClose:"close"}),a(d).next().find(".ui-dropdownchecklist-selector").click(function(){a(this).css("height","18px"),a(this).find(".ui-dropdownchecklist-text").html("selecting...").css({color:"#08c"})});var e=a(d).next().next().width();a(d).next().next().width(e+20),b.search.ddclOnComplete(d)}}},ddclTextFormatFunction:function(b){return a(b).parent().next().find(".ui-dropdownchecklist-text").html("selecting...").css({color:"#08c"}),"selecting..."},ddclOnComplete:function(b){var c="",d=0,e="#333";a(b).next().next().find(".ui-dropdownchecklist-item:has(input:checked)").each(function(b,e){c+=a(e).find("label").html()+"<br>",d++}),d===0&&(d=1,c="Please select"),c.indexOf("(all)")!=-1&&(d=1,c="All"),a(b).next().find(".ui-dropdownchecklist-selector").css("height",d*19+"px"),a(b).next().find(".ui-dropdownchecklist-text").html(c).css({color:e})},addFilesFormSubmit:function(){var b={},c=a('input[type="checkbox"][name="selected_files"]:checked');return c.each(function(c,d){var e=a(d).data();b[e.analysis_id]=e}),a.ajax({data:a(this).serialize()+"&attributes="+JSON.stringify(b),type:a(this).attr("method"),dataType:"json",url:a(this).attr("action"),success:function(a){window.location.href=a.redirect},error:function(){a("#errorAddCartModal").modal()}}),!1},addAllFilesClick:function(){if(a(this).hasClass("disabled"))return!1;a(this).addClass("disabled");var c=a(this).parents("form"),d=a(c.find('input[type="checkbox"][name="selected_files"]')[0]).data(),e=b.search.getFiltersValues().filters;return a.ajax({data:c.serialize()+"&attributes="+JSON.stringify(d)+"&filters="+JSON.stringify(e),type:c.attr("method"),dataType:"json",url:c.attr("action"),success:function(a){window.location.href=a.redirect},error:function(){a("#errorAddCartModal").modal()}}),!1},getFiltersValues:function(){var b=URI.parseQuery(window.location.search),c=!1,d=a("select.filter-select:not(.date-filters)"),e=a("input.search-query").val();return d.each(function(d,e){var f=a(e).next().next(),g=Boolean(f.find('input[value = "(all)"]:checked').length),h="",i=a(e).attr("section");return!g&&f.find("input:checked").length!==0?(f.find("input:checked").each(function(b,c){h+=a(c).val()+" OR "}),b[i]="("+h.slice(0,-4)+")",!0):g?(delete b[i],!0):(alert("Select some values."),c=!0,!1)}),(e===""||window.location.search!=="")&&a(".date-filters").each(function(){var c=a(this).next().next().find('input[type = "radio"]:checked').val();c!==""?b[a(this).attr("section")]=c:delete b[a(this).attr("section")]}),e!==""?b.q=e:delete b.q,delete b.limit,delete b.offset,{is_error:c,filters:b}},applyFilters:function(){var c=b.search.getFiltersValues(),d=URI(location.href);c.is_error||(window.location.href=d.search(c.filters)),a(this).blur()},resetFilters:function(){window.location.href="/",a(this).blur()}},b.search.init()});