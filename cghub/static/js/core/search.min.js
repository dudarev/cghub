jQuery(function(e){"use strict";var t={};this.cghub!==undefined?t=this.cghub:this.cghub=t,t.search={init:function(){t.search.cacheElements(),t.search.bindEvents(),t.search.initFlexigrid(),t.search.parseFiltersFromHref(),t.search.initDdcl()},cacheElements:function(){t.search.$searchTable=e("table.data-table"),t.search.$addFilesForm=e("form#id_add_files_form"),t.search.$applyFiltersButton=e("button#id_apply_filters"),t.search.$selectAllLink=e(".select-all"),t.search.$deselectAllLink=e(".clear-all"),t.search.$filterSelects=e("select.filter-select"),t.search.$navbarSearchForm=e("form.navbar-search")},bindEvents:function(){t.search.$navbarSearchForm.on("submit",t.search.onNavbarSearchFormSubmit),t.search.$addFilesForm.on("submit",t.search.addFilesFormSubmit),t.search.$applyFiltersButton.on("click",t.search.applyFilters)},onNavbarSearchFormSubmit:function(){return t.search.applyFilters(),!1},parseFiltersFromHref:function(){var n=URI.parseQuery(window.location.search);t.search.$filterSelects.each(function(t,r){var i=e(r),s=i.attr("section");if(s in n)if(s=="last_modified"){var o=n[s];i.find('option[value = "'+o+'"]').attr("selected","selected")}else{var u=n[s].slice(1,-1).split(" OR ");for(var t=u.length-1;t>=0;t--)i.find('option[value = "'+u[t]+'"]').attr("selected","selected")}else s=="last_modified"?window.location.search==""?i.find('option[value = "[NOW-1DAY TO NOW]"]').attr("selected","selected"):i.find('option[value = ""]').attr("selected","selected"):i.find('option[value = "(all)"]').attr("selected","selected")}),"q"in n&&e("input.search-query").val(n.q)},initFlexigrid:function(){t.search.$searchTable.flexigrid({height:"auto"})},initDdcl:function(){for(var n=t.search.$filterSelects.length-1;n>=0;n--){var r=t.search.$filterSelects[n];if(e(r).attr("section")=="last_modified")e(r).dropdownchecklist({width:170,explicitClose:"close"});else{e(r).dropdownchecklist({firstItemChecksAll:!0,width:170,textFormatFunction:t.search.ddclTextFormatFunction,onComplete:t.search.ddclOnComplete,explicitClose:"close"}),e(r).next().find(".ui-dropdownchecklist-selector").click(function(){e(this).css("height","18px"),e(this).find(".ui-dropdownchecklist-text").html("selecting...").css({color:"#08c"})});var i=e(r).next().next().width();e(r).next().next().width(i+20),t.search.ddclOnComplete(r)}}},ddclTextFormatFunction:function(t){return e(t).parent().next().find(".ui-dropdownchecklist-text").html("selecting...").css({color:"#08c"}),"selecting..."},ddclOnComplete:function(t){var n="",r=0,i="#333";e(t).next().next().find(".ui-dropdownchecklist-item:has(input:checked)").each(function(t,i){n+=e(i).find("label").html()+"<br>",r++}),r==0&&(r=1,n="Please select"),n.indexOf("(all)")!=-1&&(r=1,n="All"),e(t).next().find(".ui-dropdownchecklist-selector").css("height",r*19+"px"),e(t).next().find(".ui-dropdownchecklist-text").html(n).css({color:i})},addFilesFormSubmit:function(){var t={},n=e('input[type="checkbox"][name="selected_files"]:checked');return n.each(function(n,r){var i=e(r).data();t[i.analysis_id]=i}),e.ajax({data:e(this).serialize()+"&attributes="+JSON.stringify(t),type:e(this).attr("method"),dataType:"json",url:e(this).attr("action"),success:function(e){window.location.href=e.redirect}}),!1},applyFilters:function(){var t=URI(location.href),n=URI.parseQuery(window.location.search),r=!1,i=e('select.filter-select[section != "last_modified"]'),s=e("input.search-query").val();i.each(function(t,i){var s=e(i).next().next(),o=Boolean(s.find('input[value = "(all)"]:checked').length),u="",a=e(i).attr("section");return!o&&s.find("input:checked").length!=0?(s.find("input:checked").each(function(t,n){u+=e(n).val()+" OR "}),n[a]="("+u.slice(0,-4)+")",!0):o?(delete n[a],!0):(alert("Select some values."),r=!0,!1)});if(s==""||window.location.search!=""){var o=e(".date-filters").next().next().find('input[type = "radio"]:checked').val();o!=""?n.last_modified=o:delete n.last_modified}s!=""?n.q=s:delete n.q,console.log(n),r||(window.location.href=t.search(n))}},t.search.init()});