jQuery(function(e){"use strict";var t={};this.cghub!==undefined?t=this.cghub:this.cghub=t,t.search={init:function(){t.search.cacheElements(),t.search.bindEvents(),t.search.initFlexigrid(),t.search.parseFiltersFromHref(),t.search.initDdcl(),t.search.initCustomPeriodButtons()},cacheElements:function(){t.search.$searchTable=e("table.data-table"),t.search.$addFilesForm=e("form#id_add_files_form"),t.search.$addAllFilesButton=e("button.add-all-to-cart-btn"),t.search.$applyFiltersButton=e("button#id_apply_filters"),t.search.$resetFiltersButton=e("button#id_reset_filters"),t.search.$selectAllLink=e(".select-all"),t.search.$deselectAllLink=e(".clear-all"),t.search.$filterSelects=e("select.filter-select"),t.search.$navbarSearchForm=e("form.navbar-search")},bindEvents:function(){t.search.$navbarSearchForm.on("submit",t.search.onNavbarSearchFormSubmit),t.search.$addFilesForm.on("submit",t.search.addFilesFormSubmit),t.search.$applyFiltersButton.on("click",t.search.applyFilters),t.search.$resetFiltersButton.on("click",t.search.resetFilters),t.search.$addAllFilesButton.on("click",t.search.addAllFilesClick)},onNavbarSearchFormSubmit:function(){return t.search.applyFilters(),!1},parseFiltersFromHref:function(){var n=URI.parseQuery(window.location.search);t.search.$filterSelects.each(function(r,i){var s=e(i),o=s.attr("section");if(o in n)if(o=="last_modified"||o=="upload_date"){var u=n[o],a=s.find('option[value = "'+u+'"]');if(a.length>0)a.attr("selected","selected");else{var f=e("<option/>").attr({selected:"selected",value:u}).text(t.search.convertValueToPeriod(u)),l=e("select[section="+o+"]");l.append(f)}}else{var c=n[o].slice(1,-1).split(" OR ");if(o=="refassem_short_name")for(var r=c.length-1;r>=0;r--)s.find('option[value *= "'+c[r]+'"]').attr("selected","selected");else for(var r=c.length-1;r>=0;r--)s.find('option[value = "'+c[r]+'"]').attr("selected","selected")}else o=="upload_date"?window.location.search===""?s.find('option[value = "[NOW-7DAY TO NOW]"]').attr("selected","selected"):s.find('option[value = ""]').attr("selected","selected"):o=="state"?window.location.pathname.indexOf("search")>0?s.find('option[value = "(all)"]').attr("selected","selected"):s.find('option[value = "live"]').attr("selected","selected"):s.find('option[value = "(all)"]').attr("selected","selected")});var r=e("#modified-filter-applied").attr("data");e(".date-filters[section='last_modified']").find('option[value = "'+r+'"]').attr("selected","selected");var i=e("#uploaded-filter-applied").attr("data");e(".date-filters[section='upload_date']").find('option[value = "'+i+'"]').attr("selected","selected"),"q"in n&&e("input.search-query").val(n.q)},initFlexigrid:function(){t.search.$searchTable.flexigrid({height:"auto",showToggleBtn:!1}),e(".flexigrid .bDiv tr").contextmenu()},initDdcl:function(){for(var n=t.search.$filterSelects.length-1;n>=0;n--){var r=t.search.$filterSelects[n];if(e(r).hasClass("date-filters"))e(r).dropdownchecklist({width:180,explicitClose:"close"});else{e(r).dropdownchecklist({firstItemChecksAll:!0,width:180,textFormatFunction:t.search.ddclTextFormatFunction,onComplete:t.search.ddclOnComplete,explicitClose:"close"}),e(r).next().find(".ui-dropdownchecklist-selector").click(function(){e(this).css("height","18px"),e(this).find(".ui-dropdownchecklist-text").html("selecting...").css({color:"#08c"})});var i=e(r).next().next().width();e(r).next().next().width(i+10),t.search.ddclOnComplete(r)}}},ddclTextFormatFunction:function(t){return e(t).parent().next().find(".ui-dropdownchecklist-text").html("selecting...").css({color:"#08c"}),"selecting..."},ddclOnComplete:function(t){var n="",r=0,i="#333";e(t).next().next().find(".ui-dropdownchecklist-item:has(input:checked)").each(function(t,i){n+=e(i).find("label").html()+"<br>",r++}),r===0&&(r=1,n="Please select"),n.indexOf("(all)")!=-1&&(r=1,n="All"),e(t).next().find(".ui-dropdownchecklist-selector").css("height",r*19+"px"),e(t).next().find(".ui-dropdownchecklist-text").html(n).css({color:i})},addFilesFormSubmit:function(){var t={},n=e('input[type="checkbox"][name="selected_files"]:checked');return n.each(function(n,r){var i=e(r).data();t[i.analysis_id]=i}),e.ajax({data:e(this).serialize()+"&attributes="+JSON.stringify(t),type:e(this).attr("method"),dataType:"json",url:e(this).attr("action"),success:function(t){t.success?window.location.href=t.redirect:e("#errorAddCartModal").modal()},error:function(){e("#errorAddCartModal").modal()}}),!1},addAllFilesClick:function(){if(e(this).hasClass("disabled"))return!1;e(this).addClass("disabled");var n=e(this).parents("form"),r=[];for(var i in e(n.find('input[type="checkbox"][name="selected_files"]')[0]).data())r.push(i);var s=URI.parseQuery(window.location.search);return jQuery.isEmptyObject(s)&&(s=t.search.getFiltersValues().filters),e.ajax({data:n.serialize()+"&attributes="+JSON.stringify(r)+"&filters="+JSON.stringify(s),type:n.attr("method"),dataType:"json",url:n.attr("action"),success:function(t){t.success?window.location.href=t.redirect:e("#errorAddCartModal").modal()},error:function(){e("#errorAddCartModal").modal()}}),!1},getFiltersValues:function(){var t=URI.parseQuery(window.location.search),n=!1,r=e("select.filter-select:not(.date-filters)"),i=e("input.search-query").val();return r.each(function(r,i){var s=e(i).next().next(),o=Boolean(s.find('input[value = "(all)"]:checked').length),u="",a=e(i).attr("section");return!o&&s.find("input:checked").length!==0?(s.find("input:checked").each(function(t,n){u+=e(n).val()+" OR "}),t[a]="("+u.slice(0,-4)+")",!0):o?(delete t[a],!0):(alert("Select some values."),n=!0,!1)}),(i===""||window.location.search!=="")&&e(".date-filters").each(function(){var n=e(this).find("option:selected").val();n!==""?t[e(this).attr("section")]=n:delete t[e(this).attr("section")]}),i!==""?t.q=i:delete t.q,delete t.limit,delete t.offset,{is_error:n,filters:t}},applyFilters:function(){var n=t.search.getFiltersValues(),r=URI(location.href);n.is_error||(window.location.href=r.search(n.filters)),e(this).blur()},resetFilters:function(){window.location.href="/",e(this).blur()},createCustomDatepickers:function(){e(".dp-container").remove();var t=e("<div/>").addClass("dp-container well"),n=e("<h6/>").text("Please select the period"),r=e('<div class="dp-date" id="dp-start" data-defaultdate="+0d">'),i=e('<div class="dp-date" id="dp-end" data-defaultdate="+0d">'),s=e("<button/>").addClass("btn-submit btn").attr("type","submit").text("Submit"),o=e("<button/>").addClass("btn-cancel btn").text("Cancel");return e.each([n,r,i,e("<br/>"),s,o],function(n,r){e(this).appendTo(t)}),e.each([r,i],function(t,n){var r=e(this);r.datepicker({changeMonth:!0,changeYear:!0,defaultDate:r.data("defaultdate"),yearRange:"c-2y:c",dateFormat:"yy/mm/dd"})}),t},initCustomPeriodButtons:function(){e('.sidebar input[value="[NOW-1YEAR TO NOW]"]').each(function(n,r){e(r).parent().parent().find(".ui-dropdownchecklist-close").before(e('<div class="ui-state-default ui-dropdownchecklist-item js-pick-period" style="text-align: center"><span class="ui-dropdownchecklist-text">Pick period</span></div>').hover(function(){e(this).addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover")}).click(function(){var n=t.search.createCustomDatepickers().css("top",e(r).parents(".ui-dropdownchecklist-dropcontainer-wrapper").offset().top-40).appendTo(".sidebar");n.find(".btn-cancel").click(function(){return n.remove(),!1}),n.find(".btn-submit").click(function(){var i=n.find("#dp-start").datepicker({dateFormat:"yy/mm/dd"}).val(),s=n.find("#dp-end").datepicker({dateFormat:"yy/mm/dd"}).val(),o=t.search.convertPeriodToValue(i,s),u=e(r).parents(".ui-dropdownchecklist-dropcontainer-wrapper"),a=u.prev().prev();return u.find("input").prop("checked",!1).change(function(){a.find(".js-custom-option").remove(),a.dropdownchecklist("refresh")}),a.find("option").attr("selected",!1),a.find(".js-custom-option").remove(),a.append(e("<option/>").attr({value:o,selected:"selected"}).text(t.search.convertValueToPeriod(o)).addClass("js-custom-option")),a.dropdownchecklist("refresh"),n.remove(),!1})}))})},convertPeriodToValue:function(t,n){var r=864e5,i=new Date,s=Date.parse(i),o=Date.parse(n),u=Date.parse(t);e(".dp-container > .text-error").remove(),u>s&&(u=s),o>s&&(o=s);var a=Math.floor((s-o)/r),f=Math.floor((s-u)/r);f==a&&(f+=1);var l="[NOW-"+f+"DAY",c="NOW-"+a+"DAY]";return(s-o)/r<1&&(c="NOW]"),o<u?c+" TO "+l:l+" TO "+c},convertValueToPeriod:function(t){var n=864e5,r=new Date,i=Date.parse(r),s=t.slice(1,-1).split(" TO "),o=parseInt(s[0].split("-").reverse()[0].slice(0,-3)),u=parseInt(s[1].split("-").reverse()[0].slice(0,-3));isNaN(o)?o=0:o*=n,isNaN(u)?u=0:u*=n;var a=new Date(i-o),f=new Date(i-u);return a=e.datepicker.formatDate("yy/mm/dd",a),f=e.datepicker.formatDate("yy/mm/dd",f),a+" - "+f}},t.search.init()});