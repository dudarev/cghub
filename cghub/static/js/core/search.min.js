jQuery(function(a){"use strict";var b={};void 0!==this.cghub?b=this.cghub:this.cghub=b,b.search={addToCartErrorTitle:"Error Adding to Cart",addToCartErrorContent:'There was an error while adding to the cart. Please contact admin: <a href="mailto:'+b.vars.supportEmail+'">'+b.vars.supportEmail+"</a>",nothingSelectedTitle:"No selected files",nothingSelectedContent:"Please select some files to add them to cart",spaceStr:"    ",init:function(){b.search.cacheElements(),b.search.bindEvents(),b.search.initFlexigrid(),b.search.parseAppliedFilters(),b.search.initDdcl(),b.search.initCustomPeriodButtons(),b.search.initRememberFilters()},cacheElements:function(){b.search.$searchTable=a("table.data-table"),b.search.$addFilesForm=a("#id_add_files_form"),b.search.$addFilesButton=a(".add-to-cart-btn"),b.search.$addAllFilesButton=a("button.add-all-to-cart-btn"),b.search.$applyFiltersButton=a("button.js-apply-filters"),b.search.$resetFiltersButton=a("button.js-reset-filters"),b.search.$selectAllLink=a(".select-all"),b.search.$deselectAllLink=a(".clear-all"),b.search.$filterSelects=a("select.filter-select"),b.search.$navbarSearchForm=a("form.navbar-search"),b.search.$messageModal=a("#messageModal"),b.search.$manyItemsModal=a("#manyItemsModal"),b.search.$numResults=a(".js-num-results"),b.search.$searchField=a(".navbar-search input"),b.search.$rememberFiltersCheckbox=a(".js-remember-filters input")},bindEvents:function(){b.search.$navbarSearchForm.on("submit",b.search.onNavbarSearchFormSubmit),b.search.$addFilesForm.on("submit",b.search.addFilesFormSubmit),b.search.$applyFiltersButton.on("click",b.search.applyFilters),b.search.$resetFiltersButton.on("click",b.search.resetFilters),b.search.$addAllFilesButton.on("click",b.search.addAllFilesClick),b.search.$manyItemsModal.find(".js-yes").on("click",b.search.addAllFiles)},initRememberFilters:function(){var c=sessionStorage.getItem("remember-filters");null===c&&(c="true"),b.search.$rememberFiltersCheckbox.prop("checked","true"==c),b.search.$rememberFiltersCheckbox.on("change",function(){sessionStorage.setItem("remember-filters",a(this).prop("checked"))})},onNavbarSearchFormSubmit:function(){return b.search.applyFilters(),!1},parseAppliedFilters:function(){var c={};a(".applied-filters ul li").each(function(){var b=a(this).data("filters");"number"==typeof b&&(b=10>b?"0"+b:""+b),c[a(this).data("name")]=b.split("&")}),b.search.$filterSelects.each(function(d,e){var f=a(e),g=f.attr("data-section");if(g in c)if("refassem_short_name"==g)f.find("option").each(function(b,d){for(var e=a(d).val().split(" OR "),f=!0,h=0;h<e.length;h++)if(-1==a.inArray(e[h],c[g])){f=!1;break}f&&a(d).attr("selected","selected")});else if("last_modified"==g||"upload_date"==g){var h=c[g][0],i=f.find('option[value = "'+h+'"]');if(i.length>0)i.attr("selected","selected");else{var j=a("<option/>").attr({selected:"selected",value:h}).text(b.search.convertValueToPeriod(h));f.append(j)}}else for(var d=0;d<c[g].length;d++)f.find('option[value="'+c[g][d]+'"]').attr("selected","selected");else f.find('option[value=""]').attr("selected","selected"),f.find('option[value="(Toggle all)"]').attr("selected","selected")}),a("input.search-query").val("")},initFlexigrid:function(){b.search.$searchTable.flexigrid({height:"auto",showToggleBtn:!1}),a(".data-table").css("visibility","visible");var c=a(".bDiv table");c.wrap(a("<fieldset/>")),c.parent().prepend(a('<legend class="hidden">Select files to add to cart:</legend>')),a("#id-col-files_size .sort-link").on("click",function(){return!1})},updateRootItemValue:function(a){if(a){for(var c=0,d=a.next(),e=a.data("level")+1;parseInt(d.data("level"))==e;){if(!d.find("input").prop("checked")){c+=1;break}d=d.next()}if(0==c?a.find("input").prop("checked",!0):a.find("input").prop("checked",!1),e>1){for(;parseInt(a.data("level"))==e-1&&(a=a.prev()););b.search.updateRootItemValue(a)}}},updateToggleAll:function(b){var c=0;b.parent().find(".ui-dropdownchecklist-item:not(:first)").each(function(b,d){0==a(d).find("input").prop("checked")&&(c+=1)}),b.parent().find(".ui-dropdownchecklist-item").first().find("input").prop("checked",!Boolean(c))},initDdcl:function(){for(var c=0;c<b.search.$filterSelects.length;c++){var d=b.search.$filterSelects[c];a(d).hasClass("date-filters")?a(d).dropdownchecklist({width:185,zIndex:1010,explicitClose:"close"}):(b.search.$filterSelects.each(function(c,d){var e="",f=void 0;a(d).find("option").each(function(c,d){for(var g=a.trim(a(d).text()),h="";0==g.indexOf("-");)h+=b.search.spaceStr,g=g.substring(1);h.length&&(a(d).text(h+g),h.length>e.length&&f.attr("value","")),e=h,f=a(d)})}),a(d).dropdownchecklist({firstItemChecksAll:!0,width:185,zIndex:1010,textFormatFunction:b.search.ddclTextFormatFunction,onComplete:b.search.ddclOnComplete,explicitClose:"close"}),b.search.ddclOnComplete(d));var e=a(d).next().next().width();a(d).next().next().width(e+30),a(d).attr("id",a(d).prev().attr("for"))}a("#filters-bar .ui-dropdownchecklist-item label").each(function(c,d){var e=a(d).text().split(b.search.spaceStr).length-1;a(d).parent().attr("data-level",e)}),a('#filters-bar .ui-dropdownchecklist-item input[type="checkbox"][value=""]').each(function(c,d){b.search.updateRootItemValue(a(d).parent())}),a('#filters-bar .ui-dropdownchecklist-item input[type="checkbox"][value=""]').on("change",function(c){for(var d=a(c.target).parent(),e=parseInt(d.data("level")),f=d.next(),g=a(c.target).prop("checked");parseInt(f.data("level"))>e;)f.find("input").prop("checked",g),f=f.next();if(e>0){for(;parseInt(d.data("level"))<e&&(d=d.prev()););b.search.updateRootItemValue(d)}b.search.updateToggleAll(d)}),a('#filters-bar .ui-dropdownchecklist-item input[type="checkbox"]:not([value=""])').on("change",function(c){var d=a(c.target).parent(),e=parseInt(d.data("level"));if(e>0){for(var f=d.prev();parseInt(f.data("level"))==e;)f=f.prev();b.search.updateRootItemValue(f)}"(Toggle all)"!=a(c.target).val()&&b.search.updateToggleAll(d)}),a(".sidebar").css("visibility","visible"),a.browser.msie&&a(document).on("keydown",".ui-dropdownchecklist-dropcontainer",function(a){return 13==a.which?!1:void 0})},ddclTextFormatFunction:function(){},ddclOnComplete:function(b){var c="",d=0,e="#333";a(b).next().next().find(".ui-dropdownchecklist-item:has(input:checked)").each(function(b,e){var f=a(e);f.find("input").val().length&&(c+='<span class="ui-dropdownchecklist-text-item">'+f.find("label").html().split("&nbsp;").join("")+"</span><br>"),d++}),0===d&&(d=1,c="Please select"),-1!=c.indexOf("(Toggle all)")&&(d=1,c="All"),a(b).next().find(".ui-dropdownchecklist-selector").css("height","auto"),a(b).next().find(".ui-dropdownchecklist-text").html(c).css({color:e})},addFilesFormSubmit:function(){return b.search.$addFilesButton.hasClass("disabled")?!1:(b.search.$addFilesButton.addClass("disabled"),b.selected.save(),b.selected.exists?(b.base.showSpinner(),a.ajax({data:a(this).serialize()+"&selected_items="+JSON.stringify(b.selected.get_data_list()),type:a(this).attr("method"),dataType:"json",url:a(this).attr("action"),success:function(a){"redirect"==a.action&&(window.location.href=a.redirect),"message"==a.action&&(b.search.$addFilesButton.removeClass("disabled"),b.base.hideSpinner(),b.base.showMessage(a.title,a.content)),"error"==a.action&&(b.search.$addFilesButton.removeClass("disabled"),b.base.hideSpinner(),b.base.showMessage(b.search.addToCartErrorTitle,b.search.addToCartErrorContent))},error:function(){b.search.$addFilesButton.removeClass("disabled"),b.base.hideSpinner()}}),!1):(b.base.showMessage(b.search.nothingSelectedTitle,b.search.nothingSelectedContent),b.search.$addFilesButton.removeClass("disabled"),b.base.hideSpinner(),!1))},addAllFilesClick:function(){if(a(this).hasClass("disabled"))return!1;var c=parseInt(b.search.$numResults.text(),10),d=parseInt(a(this).parents("form").data("many-files"));return c>d?(b.search.$manyItemsModal.find(".modal-body p b").text(c),b.search.$manyItemsModal.modal("show"),b.search.$manyItemsModal.find(".js-no").focus()):b.search.addAllFiles(),!1},addAllFiles:function(){var c=URI.parseQuery(window.location.search);if(jQuery.isEmptyObject(c)){var d=b.search.getFiltersValues();if(d.is_error)return!1;c=d.filters}var e=b.search.$addAllFilesButton;e.addClass("disabled"),b.base.showSpinner();var f=e.parents("form");return a.ajax({data:f.serialize()+"&filters="+JSON.stringify(c),type:f.attr("method"),dataType:"json",url:f.attr("action"),success:function(c){"redirect"==c.action&&(window.location.href=c.redirect),"message"==c.action&&(a(e).removeClass("disabled"),b.base.hideSpinner(),b.base.showMessage(c.title,c.content)),"error"==c.action&&(a(e).removeClass("disabled"),b.base.hideSpinner(),b.base.showMessage(b.search.addToCartErrorTitle,b.search.addToCartErrorContent))},error:function(){a(e).removeClass("disabled"),b.base.hideSpinner()}}),b.search.$manyItemsModal.modal("hide"),!1},getFiltersValues:function(){var c=URI.parseQuery(window.location.search),d=!b.search.checkSearchField(),e=a("select.filter-select:not(.date-filters)"),f=a("input.search-query").val();return"Search"==f&&(f=""),e.each(function(b,e){var f=a(e).next().next(),g=Boolean(f.find('input[value = "(Toggle all)"]:checked').length),h=[],i=a(e).attr("data-section");return g||0===f.find("input:checked").length?g?(delete c[i],!0):(alert("Select some values."),d=!0,!1):(f.find("input:checked").each(function(b,c){a(c).val().length&&h.push(a(c).val())}),c[i]="("+h.join(" OR ")+")",!0)}),(""===f||""!==window.location.search)&&a(".date-filters").each(function(){var b=a(this).find("option:selected").val();""!==b?c[a(this).attr("data-section")]=b:delete c[a(this).attr("data-section")]}),""!==f?c.q=f:delete c.q,delete c.offset,{is_error:d,filters:c}},applyFilters:function(){var c=b.search.getFiltersValues(),d=URI(b.search.$applyFiltersButton.data("search-url"));c.is_error||(b.search.$rememberFiltersCheckbox.prop("checked")?c.filters.remember="true":delete c.filters.remember,window.location.href=a.isEmptyObject(c.filters)?d:d.search(c.filters)),a(this).blur()},resetFilters:function(){var b=a(this).data("url");a.removeCookie("last_query",{path:b}),window.location.href=b,a(this).blur()},createCustomDatepickers:function(){a(".dp-container").remove();var c=a("<div/>").addClass("dp-container well"),d=a("<h6/>").text("Please select the period"),e=a('<div class="dp-date" id="dp-start" data-defaultdate="+0d">'),f=a('<div class="dp-date" id="dp-end" data-defaultdate="+0d">'),g=a("<button/>").addClass("btn-submit btn").attr("type","submit").text("Submit"),h=a("<button/>").addClass("btn-cancel btn").text("Cancel");return a.each([d,e,f,a("<br/>"),g,h],function(){a(this).appendTo(c)}),a.each([e,f],function(){var c=a(this);c.datepicker({changeMonth:!0,changeYear:!0,maxDate:b.base.toUTC(new Date),defaultDate:c.data("defaultdate"),yearRange:"c-2y:c",dateFormat:"yy/mm/dd",onChangeMonthYear:function(a,b){var d=new Date(a,b,0).getDate(),e=c.datepicker("getDate");e.getDate()>d?e.setMonth(b-1,d):e.setMonth(b-1),e.setYear(a),c.datepicker("setDate",e)}})}),c},initCustomPeriodButtons:function(){a('.sidebar input[value="[NOW-1YEAR TO NOW]"]').each(function(c,d){a(d).parent().parent().find(".ui-dropdownchecklist-close").before(a('<div class="ui-state-default ui-dropdownchecklist-item js-pick-period" style="text-align: center"><span class="ui-dropdownchecklist-text">Pick period</span></div>').hover(function(){a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")}).click(function(){var c=b.search.createCustomDatepickers().css("top",a(d).parents(".ui-dropdownchecklist-dropcontainer-wrapper").offset().top-40).appendTo(".sidebar");c.find(".btn-cancel").click(function(){return c.remove(),!1}),c.find(".btn-submit").click(function(){var e=c.find("#dp-start").datepicker({dateFormat:"yy/mm/dd"}).val(),f=c.find("#dp-end").datepicker({dateFormat:"yy/mm/dd"}).val(),g=b.search.convertPeriodToValue(e,f),h=a(d).parents(".ui-dropdownchecklist-dropcontainer-wrapper"),i=h.prev().prev();return h.find("input").prop("checked",!1).change(function(){i.find("option").attr("selected",!1),i.find('option[value = "'+a(this).val()+'"]').attr("selected","selected"),i.find(".js-custom-option").remove(),i.dropdownchecklist("refresh")}),i.find("option").attr("selected",!1),i.find(".js-custom-option").remove(),i.append(a("<option/>").attr({value:g,selected:"selected"}).text(b.search.convertValueToPeriod(g)).addClass("js-custom-option")),i.dropdownchecklist("refresh"),c.remove(),!1})}))})},convertPeriodToValue:function(c,d){var e=864e5,f=b.base.toUTC(new Date),g=Date.parse(d),h=Date.parse(c);if(a(".dp-container > .text-error").remove(),h>f&&(h=f),g>f&&(g=f),h>g){var i=h;h=g,g=i}var j=Math.floor((f-g)/e),k=Math.floor((f-h)/e);k==j&&(k+=1);var l="[NOW-"+k+"DAY",m="NOW-"+j+"DAY]";return 1>(f-g)/e&&(m="NOW]"),l+" TO "+m},convertValueToPeriod:function(c){var d=864e5,e=b.base.toUTC(new Date),f=c.slice(1,-1).split(" TO "),g=parseInt(f[0].split("-").reverse()[0].slice(0,-3)),h=parseInt(f[1].split("-").reverse()[0].slice(0,-3));isNaN(g)?g=0:g*=d,isNaN(h)?h=0:h*=d;var i=new Date(e-g),j=new Date(e-h);return i=a.datepicker.formatDate("yy/mm/dd",i),j=a.datepicker.formatDate("yy/mm/dd",j),i+" - "+j},checkSearchField:function(){for(var a=b.search.$searchField.val(),c=0;c<b.base.reservedChars.length;c++)if(-1!=a.indexOf(b.base.reservedChars[c]))return b.base.showMessage(b.base.usedReservedCharsTitle,b.base.usedReservedCharsContent),!1;return!0}},b.search.init()}),jQuery(function(a){"use strict";var b={};void 0!==this.cghub?b=this.cghub:this.cghub=b,b.selected={_storage_key:"selectedItems",exists:!1,items:{},init:function(){var c=sessionStorage.getItem(b.selected._storage_key);null!==c&&(b.selected.items=a.parseJSON(c),sessionStorage.setItem(b.selected._storage_key,"{}")),b.selected.count()},save:function(){var c=a('input[type="checkbox"][name="selected_files"]:checked');c.each(function(c,d){b.selected.add(a(d).val())});var c=a('input[type="checkbox"][name="selected_files"]:not(:checked)');c.each(function(c,d){delete b.selected.items[a(d).val()]}),sessionStorage.setItem(b.selected._storage_key,JSON.stringify(b.selected.items))},add:function(c){var d=a('input[type="checkbox"][value="'+c+'"]');d.length&&(b.selected.items[c]=d.data(),b.selected.exists=!0)},ids:function(){var a=[];for(var c in b.selected.items)a.push(c);return a},get_ids_list:function(){return sessionStorage.setItem(b.selected._storage_key,"{}"),b.selected.ids()},get_data_list:function(){var c=[];return a.each(b.selected.items,function(a,b){c.push(b)}),sessionStorage.setItem(b.selected._storage_key,"{}"),c},count:function(){var a=0;for(var c in b.selected.items)a+=1;return b.selected.exists=a>0?!0:!1,a}},b.selected.init(),b.table={clearSelectionTimeout:void 0,init:function(){b.table.cacheElements(),b.table.bindEvents(),b.table.$selectAllCheckbox.removeAttr("disabled"),b.table.repairSelection()},cacheElements:function(){b.table.$itemsPerPageLink=a(".items-per-page-label > a"),b.table.$pageLink=a(".pagination ul li a"),b.table.$selectAllCheckbox=a(".js-select-all"),b.table.$checkboxes=a(".data-table-checkbox"),b.table.$flexigrid=a(".flexigrid"),b.table.$tableContainer=b.table.$flexigrid.find(".bDiv"),b.table.$tableHeaderContainer=b.table.$flexigrid.find(".hDiv")},bindEvents:function(){b.table.activateItemDetailsLinks(),b.table.$itemsPerPageLink.unbind("click"),b.table.$itemsPerPageLink.on("click",b.selected.save),b.table.$pageLink.on("click",b.selected.save),b.table.$selectAllCheckbox.on("change",b.table.changeCheckboxes),b.table.$checkboxes.on("change",b.table.updateSelectAll),b.table.$checkboxes.on("focusin",b.table.tableCheckboxFocus),b.table.$checkboxes.on("focusout",b.table.tableCheckboxFocus),b.table.$flexigrid.on("keydown",b.table.arrowPress),b.table.$tableHeaderContainer.on("scroll",function(){b.table.$tableContainer.scrollLeft(b.table.$tableHeaderContainer.scrollLeft())}),b.table.$flexigrid.find(".details-link").contextmenu()},activateItemDetailsLinks:function(){a(document).on("click",".bDiv .details-link",function(){var c=a(this),d=a(c.attr("data-target")),e=!1;return d.on("shown",function(){e||d.find(".modal-body").load(c.attr("data-details-url")+"?ajax=1",function(a,c){"error"==c?d.find(".modal-body").html('There was an error loading data. Please contact admin: <a href="mailto:'+b.vars.supportEmail+'">'+b.vars.supportEmail+"</a>"):e=!0})}).on("show",function(){d.find(".modal-body").html("Loading ..."),d.find(".modal-label").html("Details for Analysis Id "+c.parents("tr").attr("data-analysis_id"))}).modal("show"),!1}),a(document).on("click",".js-details-popup",function(){var b=a(a(this).parents("ul").data("e").target).parents("td");return b.trigger("click"),!1}),a(document).on("click",".js-details-page",function(){var b=a(a(this).parents("ul").data("e").target).parents("td");return window.open(b.attr("data-details-url"),"_blank"),window.focus(),!1}),a.browser.msie&&a(document).on("click",".js-cart-add-item-button",function(){var b=a(this).parent().attr("action"),c=document.createElement("form");return c.action=b,c.method="POST",c.id="ie-form",document.body.appendChild(c),c.submit(),document.body.removeChild(c),!1})},changeCheckboxes:function(){b.table.$checkboxes.prop("checked",a(this).is(":checked"))},updateSelectAll:function(){b.table.$selectAllCheckbox.prop("checked",b.table.$checkboxes.length==a(".data-table-checkbox:checked").length)},repairSelection:function(){var c=b.selected.ids();if(c.length){for(var d in c){var e=a(".data-table-checkbox[value="+c[d]+"]");e.length&&e.prop("checked",!0)}a("input.data-table-checkbox:checked").length==a("input.data-table-checkbox").length&&a(".js-select-all").prop("checked",!0)}},tableCheckboxFocus:function(c){"focusin"==c.type?a(this).parents("td").addClass("tdSelected"):"focusout"==c.type&&(a(this).parents("td").removeClass("tdSelected"),b.table.clearSelectionTimeout&&clearTimeout(b.table.clearSelectionTimeout),b.table.clearSelectionTimeout=setTimeout(function(){var b=a(".tdSelected");1!=b.length||b.find("input").length||b.removeClass("tdSelected")},500))},arrowPress:function(c){var d=c.which?c.which:c.keyCode;if(c.ctrlKey&&13==d){var e=a("td.tdSelected");return e.length&&(window.open(e.parents("tr").attr("data-details-url"),"_blank"),window.focus()),!1}if(c.altKey){if(18==d)return!1;if(13==d)return a("td.tdSelected").click(),!1;if(-1!=a.inArray(d,[37,39,38,40])){var f=a("td.tdSelected");f.length>1&&(f=f.eq(1));var g=f,h=f.parents("tr"),i=h.children().index(f),j=h;if(37==d)do g=a(g).prev();while(g.is("td")&&!a(g).is(":visible"));if(39==d)do g=a(g).next();while(g.is("td")&&!a(g).is(":visible"));if(38==d){if(j=a(j).prev(),!j.is("tr"))return!1;g=j.find("td:nth-child("+(i+1)+")")}if(40==d){if(j=a(j).next(),!j.is("tr"))return!1;g=j.find("td:nth-child("+(i+1)+")")}return g.is("td")?(a(".tdSelected").removeClass("tdSelected"),g.addClass("tdSelected"),g.parents("tr").find("input").focus(),b.table.scrollTableToCell(g),!1):!1}}},scrollTableToCell:function(c){var d=a(c).offset().left,e=d+a(c).width(),f=b.table.$flexigrid.offset().left,g=f+b.table.$flexigrid.width();e>g&&b.table.$tableContainer.scrollLeft(b.table.$tableContainer.scrollLeft()+e-g+50),f>d&&b.table.$tableContainer.scrollLeft(b.table.$tableContainer.scrollLeft()-f+d-50)}},b.table.init()});