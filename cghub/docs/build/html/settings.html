

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Settings &mdash; CGHub Browser 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="CGHub Browser 0.1 documentation" href="index.html" />
    <link rel="next" title="How it works" href="howitworks.html" />
    <link rel="prev" title="Deployment" href="deployment.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="howitworks.html" title="How it works"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="deployment.html" title="Deployment"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">CGHub Browser 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="settings">
<h1>Settings<a class="headerlink" href="#settings" title="Permalink to this headline">¶</a></h1>
<div class="section" id="wsapi">
<h2>WSAPI<a class="headerlink" href="#wsapi" title="Permalink to this headline">¶</a></h2>
<p>It is possible to set some settings for wsapi app.</p>
<p><tt class="docutils literal"><span class="pre">settings/wsapi.py</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">WSAPI_CGHUB_SERVER</span> <span class="o">=</span> <span class="s">&#39;https://cghub.ucsc.edu&#39;</span>
<span class="n">WSAPI_CGHUB_ANALYSIS_ID_URI</span> <span class="o">=</span> <span class="s">&#39;/cghub/metadata/analysisId&#39;</span>
<span class="n">WSAPI_CGHUB_ANALYSIS_ATTRIBUTES_URI</span> <span class="o">=</span> <span class="s">&#39;/cghub/metadata/analysisAttributes&#39;</span>
<span class="n">WSAPI_USE_CACHE</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">WSAPI_CACHE_BACKEND</span> <span class="o">=</span> <span class="s">&#39;simple&#39;</span>
<span class="n">WSAPI_CACHE_DIR</span> <span class="o">=</span> <span class="s">&#39;/tmp/wsapi/&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="celery">
<h2>Celery<a class="headerlink" href="#celery" title="Permalink to this headline">¶</a></h2>
<p>To run periodic tasks (for now only related to <em class="xref std std-ref">caching</em>) we use Celery.
Its settings are in <tt class="docutils literal"><span class="pre">settings/celery_settings.py</span></tt>.</p>
<p>In <tt class="docutils literal"><span class="pre">local.py</span></tt> define BROKER_URL</p>
<p><tt class="file docutils literal"><span class="pre">local.py</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># $ rabbitmqctl add_user myuser mypassword</span>
<span class="c"># $ rabbitmqctl add_vhost myvhost</span>
<span class="c"># $ rabbitmqctl set_permissions -p myvhost myuser &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</span>
<span class="c"># Example</span>
<span class="c"># BROKER_URL = &quot;amqp://cghub:cghub@localhost:5672/cghub&quot;</span>

<span class="c"># BROKER_URL = &quot;amqp://user:password@host:port/vhost&quot;</span>
</pre></div>
</div>
<p><tt class="file docutils literal"><span class="pre">celery_settings.py</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">djcelery</span>

<span class="kn">from</span> <span class="nn">.cache</span> <span class="kn">import</span> <span class="n">TIME_CHECK_CART_CACHE_INTERVAL</span><span class="p">,</span> <span class="n">TIME_CHECK_API_CACHE_INTERVAL</span>

<span class="n">djcelery</span><span class="o">.</span><span class="n">setup_loader</span><span class="p">()</span>

<span class="n">CELERY_IMPORTS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">&quot;cghub.apps.cart.tasks&quot;</span><span class="p">,</span>
    <span class="s">&quot;cghub.apps.core.tasks&quot;</span><span class="p">,</span>
    <span class="p">)</span>

<span class="n">CELERYBEAT_SCHEDULE</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;clear-cart-cache&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&quot;task&quot;</span><span class="p">:</span> <span class="s">&quot;cghub.apps.cart.tasks.cache_clear_task&quot;</span><span class="p">,</span>
        <span class="s">&quot;schedule&quot;</span><span class="p">:</span> <span class="n">TIME_CHECK_CART_CACHE_INTERVAL</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="s">&quot;clear-api-cache&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&quot;task&quot;</span><span class="p">:</span> <span class="s">&quot;cghub.apps.core.tasks.api_cache_clear_task&quot;</span><span class="p">,</span>
        <span class="s">&quot;schedule&quot;</span><span class="p">:</span> <span class="n">TIME_CHECK_API_CACHE_INTERVAL</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

<span class="n">CELERY_RESULT_BACKEND</span> <span class="o">=</span> <span class="s">&quot;amqp&quot;</span>
<span class="n">CELERYBEAT_SCHEDULER</span> <span class="o">=</span> <span class="s">&quot;djcelery.schedulers.DatabaseScheduler&quot;</span>

<span class="k">if</span> <span class="s">&#39;test&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">:</span>
    <span class="n">BROKER_URL</span> <span class="o">=</span> <span class="s">&quot;django://&quot;</span>

<span class="n">CELERYD_CONCURRENCY</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="section" id="caching">
<span id="id1"></span><h2>Caching<a class="headerlink" href="#caching" title="Permalink to this headline">¶</a></h2>
<p>Two types of caching is used:</p>
<ol class="arabic simple">
<li>Requests are cached by the API.</li>
<li>When items are added to the cart, requests are made to save XML for each result.</li>
</ol>
<div class="section" id="api-cache">
<h3>API cache<a class="headerlink" href="#api-cache" title="Permalink to this headline">¶</a></h3>
<p>API does not clean cache automatically. Celery task to do so is scheduled to run. Its parameters are stored in <tt class="docutils literal"><span class="pre">settings/cache.py</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># cache.py</span>

<span class="n">TIME_DELETE_API_CACHE_FILES_OLDER</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">TIME_CHECK_API_CACHE_INTERVAL</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>They control how often the task is ran (1 hour above) and how old files are kept (2 hours).
The directory where the cache is kept is defined in the cghub settings <tt class="docutils literal"><span class="pre">cghub/settings/wsapi.py</span></tt> - <cite>WSAPI_CACHE_DIR</cite> (<tt class="docutils literal"><span class="pre">/tmp/wsapi/</span></tt> by default).</p>
</div>
<div class="section" id="cart-cache">
<h3>Cart cache<a class="headerlink" href="#cart-cache" title="Permalink to this headline">¶</a></h3>
<p>When a result is added to the cart a request to get its XML is made to external server,
so that XML could be quickly served when requested. It has similar parameters. The directory
to keep files is also specified.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># cache.py</span>

<span class="n">CART_CACHE_DIR</span> <span class="o">=</span> <span class="s">&#39;/tmp/wsapi/&#39;</span>
<span class="n">TIME_DELETE_CART_CACHE_FILES_OLDER</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">TIME_CHECK_CART_CACHE_INTERVAL</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="paging">
<h2>Paging<a class="headerlink" href="#paging" title="Permalink to this headline">¶</a></h2>
<p>The results are paged when requested from the server. This paging is done by the app, not by WSI API.
Number of results per page may be set in <tt class="docutils literal"><span class="pre">settings/ui.py</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># ui.py</span>

<span class="n">DEFAULT_PAGINATOR_LIMIT</span> <span class="o">=</span> <span class="mi">10</span>
</pre></div>
</div>
</div>
<div class="section" id="columns-ordering-and-default-state">
<h2>Columns ordering and default state<a class="headerlink" href="#columns-ordering-and-default-state" title="Permalink to this headline">¶</a></h2>
<p>Columns ordering and default state for the results table can be specified in project settings.
Default configuration is located in <tt class="docutils literal"><span class="pre">settings/ui.py</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># ui.py</span>

<span class="n">TABLE_COLUMNS</span> <span class="o">=</span> <span class="p">(</span>
<span class="p">(</span><span class="s">&#39;UUID&#39;</span><span class="p">,</span> <span class="s">&#39;visible&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="s">&#39;Study&#39;</span><span class="p">,</span> <span class="s">&#39;visible&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="s">&#39;Disease&#39;</span><span class="p">,</span> <span class="s">&#39;visible&#39;</span><span class="p">),</span>
<span class="o">...</span>
</pre></div>
</div>
<p>Allowed default states: &#8216;visible&#8217;, &#8216;hidden&#8217;.</p>
</div>
<div class="section" id="details-list-ordering">
<h2>Details list ordering<a class="headerlink" href="#details-list-ordering" title="Permalink to this headline">¶</a></h2>
<p>Details list ordering can be specified in project settings.
Default configuration is located in <tt class="docutils literal"><span class="pre">settings/ui.py</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># ui.py</span>

<span class="n">DETAILS_FIELDS</span> <span class="o">=</span> <span class="p">(</span>
<span class="s">&#39;UUID&#39;</span><span class="p">,</span>
<span class="s">&#39;Study&#39;</span><span class="p">,</span>
<span class="s">&#39;Disease&#39;</span><span class="p">,</span>
<span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="change-values-displayed-in-table">
<h2>Change values displayed in table<a class="headerlink" href="#change-values-displayed-in-table" title="Permalink to this headline">¶</a></h2>
<p>Some column values can has an absurd names. To map them to something a human would understand can be used VALUE_RESOLVERS variable.</p>
<p><tt class="docutils literal"><span class="pre">settings/ui.py</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">study_resolver</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;Other_Sequencing_Multiisolate&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&#39;CCLE&#39;</span>
    <span class="k">return</span> <span class="n">val</span>

<span class="n">VALUE_RESOLVERS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;Study&#39;</span><span class="p">:</span> <span class="n">study_resolver</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="default-filters">
<h2>Default filters<a class="headerlink" href="#default-filters" title="Permalink to this headline">¶</a></h2>
<p>Default filters can be specified in settings. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># ui.py</span>

<span class="n">DEFAULT_FILTERS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;study&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;phs000178&#39;</span><span class="p">,</span> <span class="s">&#39;*Other_Sequencing_Multiisolate&#39;</span><span class="p">),</span>
    <span class="s">&#39;state&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;live&#39;</span><span class="p">,),</span>
    <span class="s">&#39;upload_date&#39;</span><span class="p">:</span> <span class="s">&#39;[NOW-7DAY TO NOW]&#39;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Filters can be found in <tt class="file docutils literal"><span class="pre">cghub/apps/core/filters_storage_full.py</span></tt> or copied from browser&#8217;s address field, for example, for specified DEFAULT_FILTERS, address will be next:</p>
<div class="highlight-python"><pre>https://cghub.ucsc.edu/browser/search/?upload_date=[NOW-7DAY+TO+NOW]&amp;study=(phs000178+OR+*Other_Sequencing_Multiisolate)&amp;state=(live)</pre>
</div>
</div>
<div class="section" id="logging">
<h2>Logging<a class="headerlink" href="#logging" title="Permalink to this headline">¶</a></h2>
<p><tt class="file docutils literal"><span class="pre">cghub/setting/local.py.default</span></tt> contains the example of a SysLogHadler usage. Default configuration located in <tt class="file docutils literal"><span class="pre">cghub/setting/logging_settings.py</span></tt>.</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="kn">from</span> <span class="nn">logging.handlers</span> <span class="kn">import</span> <span class="n">SysLogHandler</span>

    <span class="n">LOGGING</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;version&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s">&#39;disable_existing_loggers&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
    <span class="s">&#39;formatters&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;verbose&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;format&#39;</span><span class="p">:</span> <span class="s">&#39;</span><span class="si">%(levelname)s</span><span class="s"> </span><span class="si">%(asctime)s</span><span class="s"> </span><span class="si">%(module)s</span><span class="s"> </span><span class="si">%(process)d</span><span class="s"> </span><span class="si">%(thread)d</span><span class="s"> </span><span class="si">%(message)s</span><span class="s">&#39;</span>
        <span class="p">},</span>
        <span class="s">&#39;simple&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;format&#39;</span><span class="p">:</span> <span class="s">&#39;</span><span class="si">%(levelname)s</span><span class="s"> </span><span class="si">%(message)s</span><span class="s">&#39;</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="s">&#39;filters&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;require_debug_false&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;()&#39;</span><span class="p">:</span> <span class="s">&#39;django.utils.log.RequireDebugFalse&#39;</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;mail_admins&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;level&#39;</span><span class="p">:</span> <span class="s">&#39;ERROR&#39;</span><span class="p">,</span>
            <span class="s">&#39;filters&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;require_debug_false&#39;</span><span class="p">],</span>
            <span class="s">&#39;class&#39;</span><span class="p">:</span> <span class="s">&#39;django.utils.log.AdminEmailHandler&#39;</span>
        <span class="p">},</span>
        <span class="s">&#39;syslog&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;level&#39;</span><span class="p">:</span><span class="s">&#39;INFO&#39;</span><span class="p">,</span>
            <span class="s">&#39;class&#39;</span><span class="p">:</span><span class="s">&#39;logging.handlers.SysLogHandler&#39;</span><span class="p">,</span>
            <span class="s">&#39;formatter&#39;</span><span class="p">:</span> <span class="s">&#39;verbose&#39;</span><span class="p">,</span>
            <span class="s">&#39;facility&#39;</span><span class="p">:</span> <span class="n">SysLogHandler</span><span class="o">.</span><span class="n">LOG_LOCAL2</span><span class="p">,</span>
            <span class="c"># uncomment to save logs to /dev/log/syslog</span>
            <span class="s">&#39;address&#39;</span><span class="p">:</span> <span class="s">&#39;/dev/log&#39;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="s">&#39;loggers&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;django.request&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;syslog&#39;</span><span class="p">],</span>
            <span class="s">&#39;level&#39;</span><span class="p">:</span> <span class="s">&#39;ERROR&#39;</span><span class="p">,</span>
            <span class="s">&#39;propagate&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s">&#39;help.hints&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;syslog&#39;</span><span class="p">],</span>
            <span class="s">&#39;level&#39;</span><span class="p">:</span> <span class="s">&#39;INFO&#39;</span><span class="p">,</span>
            <span class="s">&#39;propagate&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre>&gt;&gt;&gt; import logging
&gt;&gt;&gt; <span class="nv">l</span> <span class="o">=</span> logging.getLogger<span class="o">(</span><span class="s1">&#39;django.request&#39;</span><span class="o">)</span>
&gt;&gt;&gt; l.error<span class="o">(</span><span class="s1">&#39;Error msg&#39;</span><span class="o">)</span>
................
jey@travelmate:/var/log<span class="nv">$ </span>tail -1 syslog
Nov 14 10:22:13 travelmate ERROR 2012-11-14 02:22:13,599 &lt;console&gt; 17654 1077970624 Error msg
</pre></div>
</div>
<p>For more information see the <a class="reference external" href="http://docs.python.org/2/library/logging.handlers.html#sysloghandler">complete SysLogHandler reference</a> .</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Settings</a><ul>
<li><a class="reference internal" href="#wsapi">WSAPI</a></li>
<li><a class="reference internal" href="#celery">Celery</a></li>
<li><a class="reference internal" href="#caching">Caching</a><ul>
<li><a class="reference internal" href="#api-cache">API cache</a></li>
<li><a class="reference internal" href="#cart-cache">Cart cache</a></li>
</ul>
</li>
<li><a class="reference internal" href="#paging">Paging</a></li>
<li><a class="reference internal" href="#columns-ordering-and-default-state">Columns ordering and default state</a></li>
<li><a class="reference internal" href="#details-list-ordering">Details list ordering</a></li>
<li><a class="reference internal" href="#change-values-displayed-in-table">Change values displayed in table</a></li>
<li><a class="reference internal" href="#default-filters">Default filters</a></li>
<li><a class="reference internal" href="#logging">Logging</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="deployment.html"
                        title="previous chapter">Deployment</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="howitworks.html"
                        title="next chapter">How it works</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/settings.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="howitworks.html" title="How it works"
             >next</a> |</li>
        <li class="right" >
          <a href="deployment.html" title="Deployment"
             >previous</a> |</li>
        <li><a href="index.html">CGHub Browser 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, CGHub UCSC.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>