{% extends 'base.html' %}
{% load static from staticfiles %}

{% block title %}Batch search - {{ block.super }}{% endblock %}
{% block extra_header_css %}
    {% if debug %}
        <link rel="stylesheet/less" type="text/css" href="{% static 'css/core/batch_search.less' %}" media="all">
    {% else %}
        <link rel="stylesheet" type="text/css" href="{% static 'css/core/batch_search.css' %}?v=1" media="all">
    {% endif %}
{% endblock %}
{% block accessibility_links %}
<ul title="Accessibility links" id="accessibility-links">
    <li>
        <a href="#nav-bar" tabindex="1">
            Skip to Navigation bar
        </a>
    </li>
    <li>
        <a href="#id_text" tabindex="2">
            Skip to batch form
        </a>
    </li>
</ul>
{% endblock %}

{% block main_content %}
<div class='batch-search-content'>

<div class="page-header">
<h1>Batch search</h1>
</div>

<form method="POST" action="." enctype="multipart/form-data">
    {% csrf_token %}
    {% if form.non_field_errors %}
        <div class="alert alert-error">
            {{ form.non_field_errors }}
        </div>
    {% endif %}
    <label for="id_text">List of ids:</label>
    {{ form.text }}
    <label for="id_upload">Or select file:</label>
    {{ form.upload }}

    <div class="batch-submit">
        <button type="submit" class="btn">Search and show results</button>
        <button type="submit" class="btn" onclick="$(this).parents('form').attr('action', '?add_to_cart=true')">Search and add items to cart</button>
    </div>

    {% if found %}
        <h2>Results:</h2>
        <ul>
            <li>Submitted ids: {{ submitted }}</li>
            <li>ids with wrong format: {{ unvalidated|length }}</li>
            {% for name, count in found.items %}
                <li>Found by {{ name }}: {{ count }}</li>
            {% endfor %}
        </ul>
    {% endif %}
    {% if unvalidated %}
        <h2>Identifiers with wrong format:</h2>
        <ul>
        {% for id in unvalidated %}
            <li>{{ id }}</li>
        {% endfor %}
        </ul>
    {% endif %}
</form>
</div>
{% endblock %}
