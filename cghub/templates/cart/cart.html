{% extends 'base.html' %}
{% load search_tags %}
{% load pagination_tags %}
{% block extra_header_css %}
    {% if debug %}
        <link rel="stylesheet/less" type="text/css" href="{{ STATIC_URL }}css/cart/cart.less" media="all">
    {% else %}
        <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/cart/cart.css" media="all">
    {% endif %}
{% endblock %}
{% block main_content %}
    {% with request.session.task_id as loading %}
    <div class="cart-content">
        <div class="page-header">
            <h1>
                In your cart
            </h1>
        </div>
        <div id="main-content"></div>
        <div>
            {% if loading %}
            <div class="alert">
                <strong>Notice:</strong> Still obtaining data... download functionality is not available until complete. <a href=".">Reload to check for completion.</a>
            </div>
            {% else %}
            {% if missed_files %}
                <div class="alert alert-error">
                    <strong>Notice:</strong> Few files was not added to your cart ({{ missed_files }}).
                </div>
            {% endif %}
            <span>
                Files in your cart: {{ stats.count }} ({{ stats.size|file_size }})
            </span>
            {% endif %}
        </div>

        <form action="{% url cart_page %}action/" method="POST">
            {% csrf_token %}
            {% if results %}
                <div class="btn-toolbar">
                    <div class="btn-group cart-btn-group">
                        <button class="btn cart-remove{% if loading %} disabled{% endif %}">Remove from cart</button>
                        <button class="btn cart-clear{% if loading %} disabled{% endif %}">Clear cart</button>
                    </div>

                    <div class="btn-group cart-btn-group">
                        <button class="btn cart-download-manifest{% if loading %} disabled{% endif %}">Download manifest</button>
                        <button class="btn cart-download-metadata{% if loading %} disabled{% endif %}">Download metadata</button>
                        <button class="btn cart-download-summary{% if loading %} disabled{% endif %}">Download summary TSV</button>
                    </div>
                </div>
                {% items_per_page request 10 25 50 %}
                <div class="column-select-label">
                    <label for="id-columns-selector" class="js-common-tooltip" data-key="columns-menu">
                        Columns:
                    </label>
                </div>
                <select id="id-columns-selector" class="column-select" multiple>
                    <option value="(all)">(all)</option>
                </select>
                {% include 'data_table.html' %}
                {% items_per_page request 10 25 50 %}
                {% pagination %}
                <div class="btn-toolbar">
                    <div class="btn-group cart-btn-group">
                        <button class="btn cart-remove{% if loading %} disabled{% endif %}">Remove from cart</button>
                        <button class="btn cart-clear{% if loading %} disabled{% endif %}">Clear cart</button>
                    </div>

                    <div class="btn-group cart-btn-group">
                        <button class="btn cart-download-manifest{% if loading %} disabled{% endif %}">Download manifest</button>
                        <button class="btn cart-download-metadata{% if loading %} disabled{% endif %}">Download metadata</button>
                        <button class="btn cart-download-summary{% if loading %} disabled{% endif %}">Download summary TSV</button>
                    </div>
                </div>
            {% else %}
                <p>Your cart is empty!</p>
            {% endif %}
        </form>
    </div>
    {% endwith %}
{% endblock %}
{% block extra_body_js %}
    {% if debug %}
        <script type="text/javascript" src="{{ STATIC_URL }}js/cart/cart.js"></script>
        <script type="text/javascript" src="{{ STATIC_URL }}js/table.js"></script>
    {% else %}
        <script type="text/javascript" src="{{ STATIC_URL }}js/cart/cart.min.js?version=1"></script>
    {% endif %}
{% endblock %}
